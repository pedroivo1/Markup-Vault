# Arch Linux Installation

## 1. Connection

### Wi-Fi Setup
Connecting to the internet via `iwctl`

```sh
iwctl
    device list
    station wlan0 scan
    station wlan0 get-networks
    station wlan0 connect <wifi> # e.g. MARIA_5G
    exit
```

## 2. Disk

### Disk Partitioning
Preparing the NVMe disk

```sh
lsblk
cfdisk /dev/<disk> # e.g. nvme0n1
    # Create partitions
    # Write
    # Quit
```

### Filesystem Formatting
Formatting the partitions (EFI, Root, Home)

```sh
mkfs.fat -F32 /dev/<partition> # e.g. nvme0n1p1
mkfs.ext4 /dev/<partition> # e.g. nvme0n1p2
mkfs.ext4 /dev/<partition> # e.g. nvme0n1p3
```

### Mount Filesystems
Mounting the partitions for installation

```sh
mount /dev/<partition> /mnt # root
mkdir /mnt/home
mkdir -p /mnt/boot/efi
mount /dev/<partition> /mnt/home # home
mount /dev/<partition> /mnt/boot/efi # boot
lsblk
```

## 3. Installation

### Mirrorlist Configuration
Updating and prioritizing Brazilian mirrors

```sh
pacman -Sy reflector
reflector --country Brazil --latest 10 --sort rate --verbose --save /etc/pacman.d/mirrorlist
```

Manually edit the list:
```sh
nano /etc/pacman.d/mirrorlist
    # Add (above other Servers):
    # `Server = https://mirror.osbeck.com/archlinux/$repo/os/$arch`
```

Update repositories:
```sh
pacman -Sy
```

### Base System Installation
Installing the base system, kernel, and firmware (including Intel microcode).

```sh
pacstrap /mnt base base-devel linux linux-headers linux-firmware nano intel-ucode
```

### Filesystem Table
Generating the fstab file.

```sh
genfstab -U /mnt > /mnt/etc/fstab
cat /mnt/etc/fstab
```

## 4. Configuration

### Chroot & Pacman Config
Accessing the installed system.

```sh
arch-chroot /mnt
```

Edit Pacman configurations:
```sh
nano /etc/pacman.conf
    # Uncomment: Color, ParallelDownloads, [multilib]
```

### Timezone & Clock
Configuring SÃ£o Paulo timezone.

```sh
ln -sf /usr/share/zoneinfo/America/Sao_Paulo /etc/localtime
hwclock --systohc
```

### Locale & Keymap
Configuring locale and keymap.

```sh
echo "en_US.UTF-8 UTF-8" > /etc/locale.gen
locale-gen
echo "LANG=en_US.UTF-8" > /etc/locale.conf
echo "KEYMAP=us" > /etc/vconsole.conf
```

### Network Identification
Defining hostname and hosts.

```sh
echo "<device>" > /etc/hostname
nano /etc/hosts
    # Add
    # 127.0.0.1      localhost
    # ::1            localhost
    # 127.0.1.1      <device>.localdomain <device>
```

### Root Password & User
```sh
passwd

EDITOR=nano visudo
    # Uncomment: %wheel ALL=(ALL:ALL) ALL

useradd -mG wheel <user>
passwd <user>
```

### Additional Packages & Bootloader
```sh
pacman -Sy dosfstools mtools os-prober networkmanager iwd grub efibootmgr

grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB --recheck
```

### Bootloader Config
```sh
nano /etc/default/grub
    # Uncomment: "GRUB_DISABLE_OS_PROBER=false" (Lastline)
    # Add: GRUB_CMDLINE_LINUX_DEFAULT="quiet splash pcie_port_pm=force nouveau.modeset=0 nvidia-drm.modeset=0 module_blacklist=nvidia,nouveau"

grub-mkconfig -o /boot/grub/grub.cfg
```

### Kernel Config (G3)
```sh
lspci -nn | grep -i nvidia
```
ponha o endereco que apareceu no KERNEL e.g.: KERNEL=="0000:01:00.0"

```sh
nano /etc/udev/rules.d/10-remove-nvidia.rules
```

```sh
ACTION=="add", KERNEL==<adress>, SUBSYSTEM=="pci", ATTR{remove}="1"
```

```sh
nano /etc/modprobe.d/blacklist-nvidia.conf
```

```sh
blacklist nouveau
blacklist nvidia
blacklist nvidia_drm
blacklist nvidia_modeset
blacklist nvidia_uvm
blacklist ipmi_msghandler
blacklist ipmi_devintf
options nouveau modeset=0
```

```
sudo mkinitcpio -P
```

### Network Configuration
```sh
systemctl enable NetworkManager

nano /etc/NetworkManager/NetworkManager.conf
    # Add:
    # [device]
    # wifi.backend=iwd
```

### Finalize
```sh
exit
umount -R /mnt
reboot
```
